<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banned</title>
    <style>
        .error {
            color: red;
        }
    </style>
</head>
<body>
    <h1>Banned</h1>
    <p>You have been banned from using the calculator; this decision is final.</p>
    <div id="ipa"></div>

    <script>
        const idk = document.getElementById("ipa");

        function httpGetAsync(url, callback) {
            const xmlHttp = new XMLHttpRequest();
            xmlHttp.onreadystatechange = function() {
                if (xmlHttp.readyState === 4) {
                    if (xmlHttp.status === 200) {
                        callback(JSON.parse(xmlHttp.responseText));
                    } else {
                        callback(null, new Error('Request failed: ' + xmlHttp.status));
                    }
                }
            };
            xmlHttp.open("GET", url, true); // true for asynchronous
            xmlHttp.send(null);
        }

        const url = "https://ipgeolocation.abstractapi.com/v1/?api_key=245e81a2c6b64af48c42747dd971e02c&ip_address=98.122.129.244";

        function fetchLocationAndSend() {
            httpGetAsync(url, function(data, error) {
                if (error) {
                    console.error("Error fetching location:", error);
                    idk.innerHTML = `<span class="error">Could not retrieve location: ${error.message}</span>`;
                    return;
                }

                if (data) {
                    const place = { ip: `${data.ip_address}` };
                    
                    idk.innerHTML = `Your IP: ${place.ip}`;

                    // Send location data to your server
                    fetch('https://meeatchicken.pythonanywhere.com/check-ban', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(place)
                    })
                    .then(response => {
                        if (!response.ok) throw new Error('Failed to send location data: ' + response.statusText);
                        return response.json();
                    })
                    .then(serverOutput => {
                        console.log('Server response:', serverOutput);
                        idk.innerHTML += `<br>${serverOutput.message}`;
                    })
                    .catch(err => {
                        console.error("Error sending location:", err);
                        idk.innerHTML += `<span class="error">Could not send location: ${err.message}</span>`;
                    });
                }
            });
        }

        window.addEventListener('load', fetchLocationAndSend);
    </script>
</body>
</html>
